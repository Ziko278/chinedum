{% extends 'admin_layout.html' %}
{% block 'page_name' %} Sale <div style="float:right" class="row">
    <div class="col-md-4">
      <input type="date" id="date" style='width:250px;display:inline;' size="16" class="form-control" name='date'>
    </div>

</div><br><br>{%endblock %}
{% block 'sub_page_name' %} Transactions {%endblock %}
{% load static %}
{% block extra_script %}
<!-- ======= EXTRA SCRIPT GOES IN HERE ======= -->
<script src="{% static 'sparrow_admin/scripts/custom/registration/staff.js' %}"></script>
{% endblock %}
{% block 'main_content' %}
<section class="panel">
    <header class="panel-heading text-center">
        <h3 class='text-center'>Recent Transactions</h3>
    </header>
    <div style='padding:15px;color:black;'>
        {% if transaction_list %}
        {% for transaction in transaction_list %}
            {% if transaction.transaction_type == 'sale' %}

			<div style="{% if transaction.sale.current_balance > 0 or transaction.sale.crate_owed > 0 %} border:1px solid red;background:wheat; {% else %} border:1px solid green;background:lightgreen;  {% endif %} padding:10px;margin:5px;">
                <h4><b>{% if transaction.client_type == 'sale_rep' %} {{ transaction.sale_rep|title }} {% elif transaction.client_type == 'customer' %} {{ transaction.customer|title }} {% else %} {% if transaction.client_detail %} {{ transaction.client_detail }} {% else %} An Anonymous Client {% endif %} {% endif %} </b>  bought items worth <b>N {{ transaction.sale.grand_total }} with {{ transaction.sale.total_crate|add:transaction.sale.crate_owed }} crates</b> on <b> {{ transaction.sale.created_at|date }}</b>, {% if transaction.sale.current_balance == 0 and transaction.sale.crate_owed == 0 %} He paid completely and brought complete bottle {% elif transaction.sale.current_balance > 0 and transaction.sale.crate_owed == 0 %} He paid <b><span class='text-success'>N {{ transaction.sale.amount_paid }}</span></b> and owed a cash balance of <b><span class='text-danger'>N {{ transaction.sale.current_balance }} </span> but brought complete crate {% elif transaction.sale.current_balance > 0 and transaction.sale.crate_owed > 0 %} he paid cash of <b>N{{ transaction.sale.amount_paid }} and brought {{ transaction.sale.total_crate }} crates </b> then owed cash of <b>N{{ transaction.sale.current_balance }} and {{ transaction.sale.crate_owed }} crates</b> {% elif transaction.sale.current_balance == 0 and transaction.sale.crate_owed > 0 %} He bought {{ transaction.sale.total_crate }} crates, paid cash completely and owed <span class='text-danger'> {{ transaction.sale.crate_owed }}</span> </b> crates {% endif %} <span style="margin-left:20px;color:red"><b>Bal: N {% if transaction.client_type == 'customer' %} {{ transaction.customer.balance }} ( {{ transaction.customer.crate_balance }} Crate ) {% elif transaction.client_type == 'sale_rep' %} {{ transaction.sale_rep.credit }} ( {{ transaction.sale_rep.crate_credit }} Crate ) {% else %} {{ transaction.total_balance }} ( {{ transaction.total_crate_balance }} Crate ) {% endif %} </b></span> <a style='float:right' href="{% url 'sale_detail' transaction.sale.sale_id %}" class='btn btn-primary'>View</a></h4>
			</div>

			{% elif transaction.transaction_type == 'refund' %}
				{% if transaction.client_type == 'sale_rep' or transaction.client_type == 'customer' %}
                {% if transaction.cash_refund > 0 or transaction.crate_refund > 0 %}
                <div style="{% if transaction.total_balance > 0 or transaction.total_crate_balance > 0 %} border:1px solid red;background:white; {% else %} border:1px solid green;background:lightgreen;  {% endif %} padding:10px;margin:5px;">
                    <h4><b>{% if transaction.client_type == 'sale_rep' %} {{ transaction.sale_rep|title }} {% elif transaction.client_type == 'customer' %} {{ transaction.customer|title }} {% else %} {% if transaction.client_detail %} {{ transaction.client_detail }} {% else %} An Anonymous Client {% endif %} {% endif %} </b>   {% if transaction.cash_refund > 0 %} refunded <b> N {{ transaction.cash_refund }} </b> from his previous balance of <b>N {{ transaction.total_balance|add:transaction.cash_refund }}, </b> {% endif %} {% if transaction.crate_refund > 0 %} returned <b>{{ transaction.crate_refund }} crate </b> out of <b>{{ transaction.total_crate_balance|add:transaction.crate_refund }} crate</b> he was owing, {% endif %} this was on <b>{{ transaction.created_at|date }}</b> <span style="margin-left:20px;color:red"><b>Bal: N {{ transaction.total_balance }} ( {{ transaction.total_crate_balance }} Crate ) </b></span> <a style='float:right'  class='btn btn-primary'>View</a></h4>
			    </div>
                {% endif %}
				{% endif %}
			{% elif transaction.transaction_type == 'Cash Balance' %}


            {% endif %}
        {% endfor %}
        {% else %}
			<h2 class="text-center">NO RECENT TRANSACTION</h2>
        {% endif %}
		</div>

</section>
{%endblock %}